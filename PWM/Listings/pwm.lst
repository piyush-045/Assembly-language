A51 MACRO ASSEMBLER  PWM                                                                  05/08/2025 12:58:36 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\pwm.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE pwm.asm SET(SMALL) DEBUG PRINT(.\Listings\pwm.lst) OBJECT(.\Objects\pwm
                      .obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1     ORG 00H
                       2              
                       3     ; Step 0: Define addresses
  00B3                 4     P1M1    EQU 0B3H
  00B4                 5     P1M2    EQU 0B4H
0000 75B3FB            6     MOV P1M1, #0FBH    ; P1.2 output mode (push-pull)
0003 75B404            7     MOV P1M2, #04H
                       8     
  00D8                 9     PWMCON0 EQU 0D8H
  00DF                10     PWMCON1 EQU 0DFH
  00D1                11     PWMPH   EQU 0D1H
  00D9                12     PWMPL   EQU 0D9H
  00DA                13     PWM0L   EQU 0DAH                                                
  00D2                14     PWM0H   EQU 0D2H
  00DE                15     PIOCON0 EQU 0DEH
  008E                16     CKCON   EQU 8EH
  00DF                17     PWMRUN  EQU 0DFH
                      18     
                      19     
                      20     
0006 110C             21     ACALL PWM_CONFIG
0008 1128             22     ACALL PWM_START
000A 80FE             23     HERE: SJMP HERE
                      24     
                      25     ;..........PWM SUBROUTINE(FUNCYION).........../
                      26     
000C                  27     PWM_CONFIG: 
000C D2DC             28     SETB 0D8H.4        ; PWMCON0.4 = CLRPWM = 1 (reset counter)
                      29     
000E 758E00           30     MOV CKCON, #00H    ; System clock
                      31     ;MOV PWMCON1,#00H ; 0000 0(000) Prescal devide is 000 = 1/1
0011 75DF04           32     MOV PWMCON1,#04H ; 0000 0(100) Prescal devide is 100 = 1/16
                      33     
                      34     
                      35     
                      36     
                      37     
                      38     
                      39     
                      40     
                      41     
                      42     
                      43     
                      44     
                      45     
                      46     
                      47     
                      48     
                      49     
                      50     
                      51     
                      52     
                      53     
                      54     ;MOV PWMPH,  #06H   ; High byte of PWM period (1599) ;10 KHZ FREOUNCY WITH PRESCALER 1
                      55     ;MOV PWMPL,  #03FH  ; Low byte of PWM period
                      56     ;MOV PWM0H, #03H    ; High byte of duty cycle (800)
                      57     ;MOV PWM0L, #020H   ; Low byte of duty cycle
A51 MACRO ASSEMBLER  PWM                                                                  05/08/2025 12:58:36 PAGE     2

                      58     
0014 75D100           59     MOV PWMPH,  #00H   ; High byte of PWM period (199) ; 5 KHZ FREOUNCY WITH PRESCALER 16
0017 75D9C7           60     MOV PWMPL,  #0C7H  ; Low byte of PWM period
001A 75D200           61     MOV PWM0H, #00H    ; High byte of duty cycle (100)
001D 75DA64           62     MOV PWM0L, #064H   ; Low byte of duty cycle
                      63     
                      64     ; Step 6: Enable PWM0 output pin
0020 75DE01           65     MOV PIOCON0, #01H  ; Enable PWM0 at P1.2
                      66     
                      67     ; Step 7: Trigger LOAD to update period/duty
0023 D2DE             68     SETB 0D8H.6        ; PWMCON0.6 = LOAD = 1
                      69     
                      70     ; Wait for LOAD auto-clear (Hardware clears LOAD automatically)
                      71     ; (OPTIONAL: You can monitor PWMCON0.6 until it becomes 0)
                      72     ; Step 8: Clear CLRPWM to allow counters to run
0025 C2DC             73     CLR 0D8H.4         ; PWMCON0.4 = CLRPWM = 0
0027 22               74     RET
                      75     
0028                  76     PWM_START: 
                      77     ; Step 9: Start PWM
0028 D2DF             78     SETB 0D8H.7        ; PWMCON0.7 = 1 = PWMRUN 
002A 22               79     RET
                      80     
002B                  81     PWM_STOP:
002B C2DF             82     CLR 0D8H.7        ; PWMCON0.7 = 0 = PWMSTOP
002D 22               83     RET
                      84     
                      85     
                      86     END
A51 MACRO ASSEMBLER  PWM                                                                  05/08/2025 12:58:36 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

CKCON. . . . . . .  N NUMB   008EH   A   
HERE . . . . . . .  C ADDR   000AH   A   
P1M1 . . . . . . .  N NUMB   00B3H   A   
P1M2 . . . . . . .  N NUMB   00B4H   A   
PIOCON0. . . . . .  N NUMB   00DEH   A   
PWM0H. . . . . . .  N NUMB   00D2H   A   
PWM0L. . . . . . .  N NUMB   00DAH   A   
PWMCON0. . . . . .  N NUMB   00D8H   A   
PWMCON1. . . . . .  N NUMB   00DFH   A   
PWMPH. . . . . . .  N NUMB   00D1H   A   
PWMPL. . . . . . .  N NUMB   00D9H   A   
PWMRUN . . . . . .  N NUMB   00DFH   A   
PWM_CONFIG . . . .  C ADDR   000CH   A   
PWM_START. . . . .  C ADDR   0028H   A   
PWM_STOP . . . . .  C ADDR   002BH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
